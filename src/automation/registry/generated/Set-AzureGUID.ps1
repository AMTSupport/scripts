#! WARNING! This script is auto-generated by Generate.ps1 from the definition ./Set-AzureGUID.json, do not edit manually.
<#
.SYNOPSIS
	Set the Azure AD Join Machine Domain GUID

.OUTPUT
	None
#>

using module ../../../../src\common\Registry.psm1
using module ../../../../src\common\Environment.psm1
using module ../../../../src\common\Ensure.psm1
using module ../../../../src\common\Logging.psm1

[CmdletBinding()]
param(
	[Parameter(Mandatory)]
	[String]$Guid
)

Invoke-RunMain $PSCmdlet {
    Invoke-EnsureAdministrator;

    $Value = "$Guid";
    $Type = "String";
    $Path = "HKLM:\\SOFTWARE\\Policies\\Microsoft\\OneDrive";
    $Key = "AADJMachineDomainGuid";
    $CurrentValue = Get-RegistryKey -Path $Path -Key $Key -ErrorAction SilentlyContinue;
    if ($CurrentValue -ne $Value) {
        Invoke-Info "Changing registry value: Path=$Path, Key=$Key, From=$CurrentValue, To=$Value"
        Set-RegistryKey -Path $Path -Key $Key -Value $Value -Kind $Type
    } else {
        Invoke-Info "Registry value already set correctly: Path=$Path, Key=$Key, Value=$Value"
    }

}

