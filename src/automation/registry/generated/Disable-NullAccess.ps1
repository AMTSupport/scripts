#! WARNING! This script is auto-generated by Generate.ps1 from the definition ./Disable-NullAccess.json, do not edit manually.
<#
.SYNOPSIS
	Disables the Null Session Access feature in Windows.

.DESCRIPTION
	Null Session Access allows unauthenticated users to access certain system resources, which can pose a security risk. Disabling this feature enhances system security by preventing unauthorized access.

.OUTPUT
	None
#>

using module ../../../../src\common\Registry.psm1
using module ../../../../src\common\Environment.psm1
using module ../../../../src\common\Ensure.psm1
using module ../../../../src\common\Logging.psm1

[CmdletBinding()]
param()

Invoke-RunMain $PSCmdlet {
    Invoke-EnsureAdministrator;

    $Value = 1;
    $Type = "DWord";
    $Path = "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa";
    $Key = "restrictanonymous";
    $CurrentValue = Get-RegistryKey -Path $Path -Key $Key -ErrorAction SilentlyContinue;
    if ($CurrentValue -ne $Value) {
        Invoke-Info "Changing registry value: Path=$Path, Key=$Key, From=$CurrentValue, To=$Value"
        Set-RegistryKey -Path $Path -Key $Key -Value $Value -Kind $Type
    } else {
        Invoke-Info "Registry value already set correctly: Path=$Path, Key=$Key, Value=$Value"
    }
    $Value = 1;
    $Type = "DWord";
    $Path = "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa";
    $Key = "restrictanonymoussam";
    $CurrentValue = Get-RegistryKey -Path $Path -Key $Key -ErrorAction SilentlyContinue;
    if ($CurrentValue -ne $Value) {
        Invoke-Info "Changing registry value: Path=$Path, Key=$Key, From=$CurrentValue, To=$Value"
        Set-RegistryKey -Path $Path -Key $Key -Value $Value -Kind $Type
    } else {
        Invoke-Info "Registry value already set correctly: Path=$Path, Key=$Key, Value=$Value"
    }
    $Value = 1;
    $Type = "DWord";
    $Path = "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\lanmanserver\\parameters";
    $Key = "restrictnullsessaccess";
    $CurrentValue = Get-RegistryKey -Path $Path -Key $Key -ErrorAction SilentlyContinue;
    if ($CurrentValue -ne $Value) {
        Invoke-Info "Changing registry value: Path=$Path, Key=$Key, From=$CurrentValue, To=$Value"
        Set-RegistryKey -Path $Path -Key $Key -Value $Value -Kind $Type
    } else {
        Invoke-Info "Registry value already set correctly: Path=$Path, Key=$Key, Value=$Value"
    }

}

