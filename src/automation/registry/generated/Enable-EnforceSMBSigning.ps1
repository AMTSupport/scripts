#! WARNING! This script is auto-generated by Generate.ps1 from the definition ./Enable-EnforceSMBSigning.json, do not edit manually.
<#
.SYNOPSIS
	Enforce SMB Signing

.DESCRIPTION
	This policy setting allows you to configure SMB signing requirements for clients and servers.

.OUTPUT
	None
#>

using module ../../../../src\common\Registry.psm1
using module ../../../../src\common\Environment.psm1
using module ../../../../src\common\Ensure.psm1
using module ../../../../src\common\Logging.psm1

[CmdletBinding()]
param()

Invoke-RunMain $PSCmdlet {
    Invoke-EnsureAdministrator;

    $Value = 1;
    $Type = "DWord";
    $Path = "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters";
    $Key = "EnableSecuritySignature";
    $CurrentValue = Get-RegistryKey -Path $Path -Key $Key -ErrorAction SilentlyContinue;
    if ($CurrentValue -ne $Value) {
        Invoke-Info "Changing registry value: Path=$Path, Key=$Key, From=$CurrentValue, To=$Value"
        Set-RegistryKey -Path $Path -Key $Key -Value $Value -Kind $Type
    } else {
        Invoke-Info "Registry value already set correctly: Path=$Path, Key=$Key, Value=$Value"
    }
    $Value = 1;
    $Type = "DWord";
    $Path = "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters";
    $Key = "RequireSecuritySignature";
    $CurrentValue = Get-RegistryKey -Path $Path -Key $Key -ErrorAction SilentlyContinue;
    if ($CurrentValue -ne $Value) {
        Invoke-Info "Changing registry value: Path=$Path, Key=$Key, From=$CurrentValue, To=$Value"
        Set-RegistryKey -Path $Path -Key $Key -Value $Value -Kind $Type
    } else {
        Invoke-Info "Registry value already set correctly: Path=$Path, Key=$Key, Value=$Value"
    }
    $Value = 1;
    $Type = "DWord";
    $Path = "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters";
    $Key = "RequireSecuritySignature";
    $CurrentValue = Get-RegistryKey -Path $Path -Key $Key -ErrorAction SilentlyContinue;
    if ($CurrentValue -ne $Value) {
        Invoke-Info "Changing registry value: Path=$Path, Key=$Key, From=$CurrentValue, To=$Value"
        Set-RegistryKey -Path $Path -Key $Key -Value $Value -Kind $Type
    } else {
        Invoke-Info "Registry value already set correctly: Path=$Path, Key=$Key, Value=$Value"
    }

}

